#!/usr/bin/env bash

BASE_DIR="$HOME/code"
failures=()

for dir in "$BASE_DIR"/*; do
  if [ -d "$dir/.git" ]; then
    repo_name=$(basename "$dir")
    echo "Updating $repo_name"
    if ! git -C "$dir" pull --ff-only; then
      failures+=("$repo_name")
    fi
  fi
done

if [ ${#failures[@]} -ne 0 ]; then
  echo
  echo "===== SUMMARY OF FAILURES ====="
  for repo in "${failures[@]}"; do
    echo "$repo needs manual intervention"
  done
else
  echo
  echo "All repositories updated successfully."
fi
